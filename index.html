<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/main.css">
    <meta charset="utf-8">
    <title>Fuzzy Memory</title>
  </head>


  <body>

    <div class="game">
      <p class="timer"></p>
    </div>

    <button class='start_button' type="button" name="button">Start New Game</button>

    <div class="board">

    </div>

    <script type="text/javascript">

    // TODO:
    // Visible time and turn count
    // Different game modes: time trial and normal
    // 6. Create difficulty settings
    // 7. Add shuffle animation
    // Theme and add pictures

    const cards = ['A', 'A', 'B', 'B', 'C', 'C', 'D', 'D', 'E', 'E', 'F', 'F', 'G', 'G', 'H', 'H']
    const board = document.querySelector('.board')
    const start = document.querySelector('.start_button');
    const compare_array = []   // This is an empty array to which, when a card is clicked, we push values that we want to compare to see if they match.
    var click_counter = 0;     // This counts +1 each time a card is clicked. We use this to know when to turn over cards that did not match.
    var turn_counter = 0;      // This counts +1 each time click_counter hits 2. We use this value to show the user how many turns the game took them.
    var timer = 0;


    // When the start button is clicked the board is cleared and a function sorts all the cards randomly.
    start.addEventListener('click', (event) => {
      board.innerHTML = " ";             // Clears board
      cards.sort(function(a, b) {        // Sorts the cards array in a random order
        return 0.5 - Math.random()
      });

      // This loops through the card array and creates a new card for each element, each consisting of a container a front and a back. We also use dataset to give each card a letter from the array so we can easily style each cards back and compare the cards later.
      cards.forEach((card) => {

        const card_container = document.createElement('div');       // Creates the divs
        card_container.classList.add('card_container');             // Adds the class .card_container
        card_container.dataset.letter = card;                       // Sets data-letter
        board.appendChild(card_container);                          // Appends to .board element

        const card_div_front = document.createElement('div');       // Creates the divs
        card_div_front.classList.add('card_front');                 // Adds the class .card_front
        card_container.appendChild(card_div_front);                 // Appends to .card_container element

        const card_div_back = document.createElement('div');        // Creates the divs
        card_div_back.classList.add('card_back');                   // Adds the class .card_back
        card_div_back.dataset.letter = card;                        // Sets data-letter
        card_container.appendChild(card_div_back);                  // Appends to .card_container element
      })

      // When a card is clicked we add a "flipped state-class" to it, to make them flip over with an animation. The animation is specified in main.css. We also add 1 to our click_counter. To make sure you cannot click the card again while it's turned over we set the CSS property pointer-events to "none" on the .card_container.
      const rendered_cards = document.querySelectorAll('.card_container');

      Array.from(rendered_cards).forEach((card) => {
        card.addEventListener('click', (e) => {

          card.style.pointerEvents = "none";

          const card_front_flipped = e.target.querySelector('.card_front');
          card_front_flipped.classList.add('card_front_flipped');          // Adds .card_front_flipped

          const card_back_flipped = e.target.querySelector('.card_back');
          card_back_flipped.classList.add('card_back_flipped');            // Adds .card_back_flipped

          const data_letter = e.target.getAttribute('data-letter');

          click_counter++;                                                // Adds 1 to click_counter variable

          console.log(click_counter);

          // Each time click_counter hits 2 we add 1 to turn_counter. We do this to keep track of how many turns the game has taken to complete.
          if (click_counter == 2) {
            turn_counter++;
            console.log('turn_counter is at',turn_counter);
          }

          // Everytime a card is clicked we add that cards data-letter to compare_array. This way we can check if the cards were a match or not. The front and back of the clicked card are also added. We do this so that we can easily remove the previously added .card_front_flipped and .card_back_flipped classes (making the cards flip back to their original states). Further we also add the .card_container (card) so that we can change CSS properties for it later. All of this happens as long as the compare_array contains less than 8 items.
          if (compare_array.length < 8) {

              compare_array.push(data_letter, card_front_flipped, card_back_flipped, card); // Pushes the data to the compare_array

              console.log(compare_array);

          }

          // Now, when the compare_array contains 8 items (i.e after 2 cards have been turned), we need to check if the cards were a match or not.
          if (compare_array.length == 8) {

            console.log(compare_array);

            // If the cards data-letters matched we set the compare_array's lengt to 0 again, thus removing all the previously pushed data. We also reset our click_counter back to 0.
            if (compare_array[0] == compare_array[4]) {

              compare_array.length = 0;

              click_counter = 0;

              console.log(click_counter);
              console.log(compare_array);
            }

            // When two cards have been turned and they did NOT match AND we click a third card (i.e click_counter hits 3) we remove the "flipped state-class" for each card in the compare_array, we set the .card_contianer's pointer-events back to "auto", we set the compare_array to 0 thus clearing the previusly pushed data, we set the click_counter to 0 but then add 1 to it again (since we just clicked a card that needs to be counted as 1 click) and lastly we push the newly clicked cards data to the compare_array.
            if (compare_array[0] != compare_array[4] && click_counter == 3)  {

              console.log(compare_array);

              compare_array[1].classList.remove('card_front_flipped');      // Flipps front of card 1
              compare_array[2].classList.remove('card_back_flipped');       // Flipps back of card 1
              compare_array[3].style.pointerEvents = "auto";                // Sets CSS property pointer-events to "auto" for card 1
              compare_array[5].classList.remove('card_front_flipped');      // Flipps front of card 2
              compare_array[6].classList.remove('card_back_flipped');       // Flipps back of card 2
              compare_array[7].style.pointerEvents = "auto";                // Sets CSS property pointer-events to "auto" for card 2

              compare_array.length = 0;                                     // Clears compare_array of data

              click_counter = 0;                                            // Sets click_counter back to 0
              click_counter++;                                              // Adds 1 to click_counter to account for the newly clicked card
              console.log(click_counter);

              console.log(compare_array);

              compare_array.push(data_letter, card_front_flipped, card_back_flipped, card);  // Pushes data of the newly clicked card to compare_array
              console.log(compare_array);

            }
          }

          })
        })
      })

    </script>




  </body>

</html>
